<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Planner z Firebase</title>
<style>
  body {
    background: #000;
    color: #f48fb1;
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
  }
  header {
    background: #1c1c1c;
    padding: 1em;
    text-align: center;
    font-size: 1.5em;
    user-select: none;
  }
  #dayTasksTitle {
    font-size: 1.2em;
    margin-top: 0.2em;
    color: #f48fb1cc;
  }
  #taskList {
    list-style: none;
    padding: 0.5em;
    margin: 0;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }
  #taskList li {
    background: #2b2b2b;
    margin: 0.4em 0;
    padding: 0.6em;
    border-radius: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    word-wrap: break-word;
  }
  #taskList li.done {
    text-decoration: line-through;
    opacity: 0.6;
  }
  .task-info {
    flex-grow: 1;
    margin-left: 1em;
  }
  .task-top {
    display: flex;
    justify-content: space-between;
    font-weight: bold;
    color: #f48fb1;
  }
  .task-category {
    font-style: italic;
    opacity: 0.7;
  }
  .task-priority {
    font-size: 0.85em;
    opacity: 0.7;
    margin-top: 0.2em;
  }
  .check, .delete {
    cursor: pointer;
    padding: 0 0.5em;
    user-select: none;
  }
  .check {
    font-size: 1.3em;
    color: #f48fb1;
  }
  .delete {
    font-size: 1.2em;
  }
  #newTaskInput, select, button {
    font-size: 1em;
    padding: 0.5em;
    margin: 0.3em 0.2em 0.3em 0;
    border-radius: 6px;
    border: none;
  }
  #newTaskInput {
    width: 55%;
    max-width: 400px;
  }
  button {
    background: #f48fb1;
    color: #000;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background: #f06292;
  }
  #taskCounter {
    text-align: center;
    margin: 0.5em 0 1em 0;
    font-size: 1em;
    color: #f48fb1aa;
  }
  /* Panel admina */
  #adminPanel {
    background: #111;
    color: #f48fb1;
    padding: 1em;
    max-width: 600px;
    margin: 1em auto;
    border-radius: 6px;
    display: none;
    flex-direction: column;
    gap: 0.5em;
  }
  #adminPanel.active {
    display: flex;
  }
  #codePrompt {
    display: none;
    text-align: center;
    margin: 1em 0;
  }
  #adminCodeInput {
    font-size: 1.2em;
    padding: 0.3em;
    width: 100px;
    border-radius: 6px;
    border: none;
    text-align: center;
  }

  /* Priorytety kolorami */
  .high {
    border-left: 5px solid #ff4081;
  }
  .medium {
    border-left: 5px solid #f48fb1;
  }
  .low {
    border-left: 5px solid #f8bbd0;
  }

  /* Responsywno≈õƒá */
  @media (max-width: 600px) {
    #newTaskInput {
      width: 100%;
      margin-bottom: 0.5em;
    }
    #taskList li {
      flex-direction: column;
      align-items: flex-start;
    }
    .task-info {
      margin-left: 0;
      margin-top: 0.3em;
      width: 100%;
    }
    .check, .delete {
      align-self: flex-end;
      padding: 0 0.3em;
    }
  }
</style>
</head>
<body>

<header id="plannerTitle">
  Zadania na dzie≈Ñ
  <div id="dayTasksTitle"></div>
</header>

<div style="max-width: 600px; margin: 0 auto; padding: 0 1em;">
  <!-- Sekcja dodawania zada≈Ñ - widoczna tylko dla admina -->
  <div id="addTaskSection" style="display:none;">
    <input id="newTaskInput" type="text" placeholder="Nowe zadanie..." />
    <select id="categorySelect" aria-label="Kategoria zadania">
      <option value="Praca">Praca</option>
      <option value="Dom">Dom</option>
      <option value="Inne">Inne</option>
    </select>
    <select id="prioritySelect" aria-label="Priorytet zadania">
      <option value="high">Wysoki</option>
      <option value="medium" selected>≈öredni</option>
      <option value="low">Niski</option>
    </select>
    <button id="addTaskBtn">Dodaj</button>
  </div>

  <div id="taskCounter">≈Åadowanie zada≈Ñ...</div>

  <ul id="taskList"></ul>
</div>

<!-- Panel admina -->
<div id="codePrompt">
  <input id="adminCodeInput" type="password" maxlength="4" placeholder="Podaj kod PIN" />
</div>
<div id="adminPanel">
  <button id="hideAdminBtn">‚úñÔ∏è Zamknij panel admina</button>
  <p>Panel admina aktywny. Mo≈ºesz usuwaƒá zadania klikajƒÖc kosz.</p>
</div>

<!-- Firebase SDK (modular) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import {
    getDatabase,
    ref,
    onValue,
    set,
    update,
    remove
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCQPWSK9l8yI944dHTSSEW9-cLTZh4Uz-I",
    authDomain: "zadanie-56c40.firebaseapp.com",
    databaseURL: "https://zadanie-56c40-default-rtdb.firebaseio.com",
    projectId: "zadanie-56c40",
    storageBucket: "zadanie-56c40.appspot.com",
    messagingSenderId: "551942794557",
    appId: "1:551942794557:web:a6323df6e91c00cb226954"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const tasksRef = ref(db, 'tasks');

  // DOM
  const plannerTitle = document.getElementById('plannerTitle');
  const dayTasksTitle = document.getElementById('dayTasksTitle');
  const taskListEl = document.getElementById('taskList');
  const newTaskInput = document.getElementById('newTaskInput');
  const categorySelect = document.getElementById('categorySelect');
  const prioritySelect = document.getElementById('prioritySelect');
  const addTaskBtn = document.getElementById('addTaskBtn');
  const adminPanel = document.getElementById('adminPanel');
  const codePrompt = document.getElementById('codePrompt');
  const adminCodeInput = document.getElementById('adminCodeInput');
  const hideAdminBtn = document.getElementById('hideAdminBtn');
  const taskCounter = document.getElementById('taskCounter');
  const addTaskSection = document.getElementById('addTaskSection');

  let tasks = {};
  let isAdmin = false;

  // Aktualna data wy≈õwietlana
  function loadNetworkDate() {
    const now = new Date();
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    dayTasksTitle.textContent = now.toLocaleDateString('pl-PL', options);
  }

  // Renderowanie listy zada≈Ñ
  function renderTasks() {
    taskListEl.innerHTML = '';
    let doneCount = 0;
    let totalCount = 0;

    for (const key in tasks) {
      if (!tasks.hasOwnProperty(key)) continue;
      const t = tasks[key];
      totalCount++;
      if (t.done) doneCount++;

      const li = document.createElement('li');
      li.className = t.priority || 'medium';
      if (t.done) li.classList.add('done');

      // Checkbox (dla u≈ºytkownik√≥w do odhaczania)
      const check = document.createElement('span');
      check.className = 'check';
      check.textContent = t.done ? '‚úîÔ∏è' : '‚òê';
      check.title = t.done ? "Kliknij, aby odznaczyƒá" : "Kliknij, aby odhaczyƒá";

      check.addEventListener('click', () => {
        // Zmie≈Ñ status done w bazie
        update(ref(db, `tasks/${key}`), { done: !t.done });
      });

      // Informacje o zadaniu
      const infoDiv = document.createElement('div');
      infoDiv.className = 'task-info';

      // G√≥rna linia z tre≈õciƒÖ i kategoriƒÖ
      const topDiv = document.createElement('div');
      topDiv.className = 'task-top';

      const taskText = document.createElement('span');
      taskText.textContent = t.text;

      const categorySpan = document.createElement('span');
      categorySpan.className = 'task-category';
      categorySpan.textContent = t.category || '';

      topDiv.appendChild(taskText);
      topDiv.appendChild(categorySpan);

      // Priorytet pod spodem
      const prioritySpan = document.createElement('div');
      prioritySpan.className = 'task-priority';
      let prioText = '';
      switch(t.priority) {
        case 'high': prioText = 'Priorytet: Wysoki'; break;
        case 'medium': prioText = 'Priorytet: ≈öredni'; break;
        case 'low': prioText = 'Priorytet: Niski'; break;
      }
      prioritySpan.textContent = prioText;

      infoDiv.appendChild(topDiv);
      infoDiv.appendChild(prioritySpan);

      li.appendChild(check);
      li.appendChild(infoDiv);

      // Przyciski usuwania tylko dla admina
      if (isAdmin) {
        const delBtn = document.createElement('span');
        delBtn.className = 'delete';
        delBtn.textContent = 'üóëÔ∏è';
        delBtn.title = "Usu≈Ñ zadanie";
        delBtn.style.color = '#f48fb1';
        delBtn.addEventListener('click', () => {
          if(confirm("Czy na pewno chcesz usunƒÖƒá to zadanie?")) {
            remove(ref(db, `tasks/${key}`));
          }
        });
        li.appendChild(delBtn);
      }

      taskListEl.appendChild(li);
    }

    taskCounter.textContent = `Wykonane zadania: ${doneCount} / ${totalCount}`;
    if(totalCount === 0) taskCounter.textContent = "Brak zada≈Ñ na dzi≈õ";
  }

  // Nas≈Çuchiwanie zmian z bazy
  onValue(tasksRef, (snapshot) => {
    tasks = snapshot.val() || {};
    renderTasks();
  });

  // Dodawanie zadania (tylko admin)
  addTaskBtn.addEventListener('click', () => {
    const text = newTaskInput.value.trim();
    if(text === '') return alert('Wpisz tre≈õƒá zadania!');
    const newTaskRef = ref(db, `tasks/${Date.now()}`);
    set(newTaskRef, {
      text,
      done: false,
      category: categorySelect.value,
      priority: prioritySelect.value
    });
    newTaskInput.value = '';
  });

  // Panel admina: pokazuj pole na kod PIN po przytrzymaniu nag≈Ç√≥wka
  let holdTimeout;
  plannerTitle.addEventListener('mousedown', () => {
    holdTimeout = setTimeout(() => {
      codePrompt.style.display = 'block';
      adminCodeInput.focus();
    }, 1000);
  });
  plannerTitle.addEventListener('mouseup', () => {
    clearTimeout(holdTimeout);
  });
  plannerTitle.addEventListener('touchstart', () => {
    holdTimeout = setTimeout(() => {
      codePrompt.style.display = 'block';
      adminCodeInput.focus();
    }, 1000);
  });
  plannerTitle.addEventListener('touchend', () => {
    clearTimeout(holdTimeout);
  });

  // Weryfikacja PIN
  adminCodeInput.addEventListener('keydown', (e) => {
    if(e.key === 'Enter') {
      if(adminCodeInput.value === '0909') {
        isAdmin = true;
        adminPanel.classList.add('active');
        addTaskSection.style.display = 'flex';
        codePrompt.style.display = 'none';
        adminCodeInput.value = '';
      } else {
        alert('Nieprawid≈Çowy kod PIN');
        adminCodeInput.value = '';
      }
    }
  });

  // Ukrywanie panelu admina
  hideAdminBtn.addEventListener('click', () => {
    isAdmin = false;
    adminPanel.classList.remove('active');
    addTaskSection.style.display = 'none';
  });

  loadNetworkDate();

</script>

</body>
</html>
