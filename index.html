<!DOCTYPE html> 
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Planner</title>
<style>
  body { background: #000; color: #f48fb1; font-family: Arial, sans-serif; margin: 0; padding: 0; }
  header {
    background: #f44336; /* poczƒÖtkowo czerwony */
    color: #fff;
    padding: 1em;
    text-align: center;
    font-size: 1.5em;
    user-select: none;
    transition: background-color 0.5s ease;
  }
  #dayTasksTitle { font-size: clamp(1.2em, 6vw, 2em); margin-top: 0.2em; color: black; }
  #plannerTitle { font-size: clamp(1.2em, 6vw, 2em); color: black; }
  #taskList { list-style: none; padding: 0.5em; margin: 0; max-width: 600px; margin-left: auto; margin-right: auto; }
  #taskList li { background: #2b2b2b; margin: 0.4em 0; padding: 0.6em; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; word-wrap: break-word; }
  #taskList li.done { text-decoration: line-through; opacity: 0.6; }
  .task-info { flex-grow: 1; margin-left: 1em; }
  .task-top { display: flex; justify-content: space-between; font-weight: bold; color: #f48fb1; }
  .task-category { font-style: italic; opacity: 0.7; }
  .task-priority { font-size: 0.85em; opacity: 0.7; margin-top: 0.2em; }
  .task-assigned { font-size: 0.85em; opacity: 0.8; margin-top: 0.2em; color: #bbb; }
  .check, .delete { cursor: pointer; padding: 0 0.5em; user-select: none; }
  .check { font-size: 1.3em; color: #f48fb1; }
  .delete { font-size: 1.2em; }
  #newTaskInput, select, button { font-size: 1em; padding: 0.5em; margin: 0.3em 0.2em 0.3em 0; border-radius: 6px; border: none; }
  #newTaskInput { width: 40%; max-width: 400px; }
  button { background: #f48fb1; color: #000; font-weight: bold; cursor: pointer; transition: background-color 0.3s ease; }
  button:hover { background: #f06292; }
  #taskCounter { text-align: center; margin: 0.5em 0 1em 0; font-size: 1em; color: #f48fb1aa; }
  #adminPanel { background: #111; color: #f48fb1; padding: 1em; max-width: 600px; margin: 1em auto; border-radius: 6px; display: none; flex-direction: column; gap: 0.5em; }
  #adminPanel.active { display: flex; }
  #codePrompt { display: none; text-align: center; margin: 1em 0; }
  #adminCodeInput { font-size: 1.2em; padding: 0.3em; width: 100px; border-radius: 6px; border: none; text-align: center; }
  .high { border-left: 5px solid red; }
  .medium { border-left: 5px solid yellow; }
  .low { border-left: 5px solid green; }
  @media (max-width: 600px) {
    #newTaskInput { width: 100%; margin-bottom: 0.5em; }
    #taskList li { flex-direction: column; align-items: flex-start; }
    .task-info { margin-left: 0; margin-top: 0.3em; width: 100%; }
    .check, .delete { align-self: flex-end; padding: 0 0.3em; }
  }
    
  .flash {
  animation: flashAnim 0.8s ease;
}

@keyframes flashAnim {
  0% { background-color: #2b2b2b; }
  50% { background-color: #4caf50; }
  100% { background-color: #2b2b2b; }
}

    



</style>
</head>
<body>

<header id="plannerTitle">
  Zadania na dzie≈Ñ
  <div id="dayTasksTitle"></div>
</header>

<div style="max-width: 600px; margin: 0 auto; padding: 0 1em;">
  <div id="addTaskSection" style="display:none; flex-wrap: wrap;">
    <input id="newTaskInput" type="text" placeholder="Nowe zadanie..." />
    <select id="categorySelect" aria-label="Kategoria zadania">
      <option value="Praca">Praca</option>
      <option value="Dom">Dom</option>
      <option value="Inne">Inne</option>
    </select>
    <select id="prioritySelect" aria-label="Priorytet zadania">
      <option value="high">Wysoki</option>
      <option value="medium" selected>≈öredni</option>
      <option value="low">Niski</option>
    </select>
    <select id="userSelect" aria-label="Przypisz do osoby">
      <option value="Pawe≈Ç">Pawe≈Ç</option>
      <option value="Justyna">Justyna</option>
      <option value="Klaudia">Klaudia</option>
      <option value="Inne">Inne</option>
    </select>

    <label style="margin-left:0.5em;">
      <input type="checkbox" id="dailyResetCheckbox" /> Resetuj codziennie
    </label>

    <button id="addTaskBtn">Dodaj</button>
  </div>

  <div style="text-align:center; margin: 0.5em 0;">
    <label for="filterUser">Filtruj zadania: </label>
    <select id="filterUser">
      <option value="all">Wszyscy</option>
      <option value="Pawe≈Ç">Pawe≈Ç</option>
      <option value="Justyna">Justyna</option>
      <option value="Klaudia">Klaudia</option>
    </select>
  </div>

  <div id="taskCounter">≈Åadowanie zada≈Ñ...</div>
  <ul id="taskList"></ul>
</div>

<div id="codePrompt">
  <input id="adminCodeInput" type="password" maxlength="4" placeholder="Podaj kod PIN" />
</div>
<div id="adminPanel">
  <button id="hideAdminBtn">‚úñÔ∏è Zamknij panel admina</button>
  <button id="resetAllBtn">üîÑ Odznacz wszystkie</button>
  <p>Panel admina aktywny. Mo≈ºesz usuwaƒá zadania klikajƒÖc kosz.</p>
</div>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue, set, update, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCQPWSK9l8yI944dHTSSEW9-cLTZh4Uz-I",
  authDomain: "zadanie-56c40.firebaseapp.com",
  databaseURL: "https://zadanie-56c40-default-rtdb.firebaseio.com",
  projectId: "zadanie-56c40",
  storageBucket: "zadanie-56c40.appspot.com",
  messagingSenderId: "551942794557",
  appId: "1:551942794557:web:a6323df6e91c00cb226954"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const tasksRef = ref(db, 'tasks');

const plannerTitle = document.getElementById('plannerTitle');
const dayTasksTitle = document.getElementById('dayTasksTitle');
const taskListEl = document.getElementById('taskList');
const newTaskInput = document.getElementById('newTaskInput');
const categorySelect = document.getElementById('categorySelect');
const prioritySelect = document.getElementById('prioritySelect');
const userSelect = document.getElementById('userSelect');
const addTaskBtn = document.getElementById('addTaskBtn');
const adminPanel = document.getElementById('adminPanel');
const codePrompt = document.getElementById('codePrompt');
const adminCodeInput = document.getElementById('adminCodeInput');
const hideAdminBtn = document.getElementById('hideAdminBtn');
const taskCounter = document.getElementById('taskCounter');
const addTaskSection = document.getElementById('addTaskSection');
const filterUser = document.getElementById('filterUser');
const dailyResetCheckbox = document.getElementById('dailyResetCheckbox');

let tasks = {};
let isAdmin = false;

function loadNetworkDate() {
  const now = new Date();
  const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
  dayTasksTitle.textContent = now.toLocaleDateString('pl-PL', options);
}

function renderTasks() {
  taskListEl.innerHTML = '';
  let doneCount = 0, totalCount = 0;
  const selectedUser = filterUser.value;

  for(const key in tasks){
    if(!tasks.hasOwnProperty(key)) continue;
    const t = tasks[key];
    if(selectedUser !== 'all' && t.assignedTo !== selectedUser) continue;

    totalCount++;
    if(t.done) doneCount++;

   const li = document.createElement('li');
li.className = t.priority || 'medium';
if(t.done) li.classList.add('done');

// Tworzymy element checkbox
const check = document.createElement('span');
check.className = 'check';
check.textContent = t.done ? '‚úîÔ∏è' : '‚òê';
li.appendChild(check);


check.addEventListener('click', async () => {
  const newDoneState = !t.done;
  await update(ref(db, `tasks/${key}`), { done: newDoneState });

  if (!t.done && newDoneState) {
    // flash animacja li
    li.classList.add('flash');
    setTimeout(() => li.classList.remove('flash'), 800);

    // d≈∫wiƒôk
    const sound = document.getElementById('taskDoneSound');
    sound.currentTime = 0;
    sound.play();

    // konfetti
    confetti({
      particleCount: 50,
      spread: 70,
      origin: { y: 0.6 },
      colors: ['#4caf50', '#a5d6a7', '#c8e6c9']
    });

    // zmiana checkboxa na ‚úîÔ∏è
    check.textContent = '‚úîÔ∏è';
  } else {
    check.textContent = '‚òê';
  }
});


    const infoDiv = document.createElement('div'); infoDiv.className = 'task-info';
    const topDiv = document.createElement('div'); topDiv.className = 'task-top';
    const taskText = document.createElement('span'); taskText.textContent = t.text;
    const categorySpan = document.createElement('span'); categorySpan.className='task-category'; categorySpan.textContent=t.category||'';
    topDiv.appendChild(taskText); topDiv.appendChild(categorySpan);

   

    const prioritySpan = document.createElement('div'); prioritySpan.className='task-priority';
    switch(t.priority){
      case 'high':prioritySpan.textContent='Priorytet: Wysoki';break;
      case 'medium':prioritySpan.textContent='Priorytet: ≈öredni';break;
      case 'low':prioritySpan.textContent='Priorytet: Niski';break;
    }

    const assignedSpan = document.createElement('div'); assignedSpan.className='task-assigned';
    assignedSpan.textContent=`Przypisane do: ${t.assignedTo||'‚Äî'}`;

    infoDiv.appendChild(topDiv); infoDiv.appendChild(prioritySpan); infoDiv.appendChild(assignedSpan);
    li.appendChild(check);
    li.appendChild(infoDiv);

    if (isAdmin) {
  // üóëÔ∏è delete
  const delBtn = document.createElement('span');
  delBtn.className = 'delete';
  delBtn.textContent = 'üóëÔ∏è';
  delBtn.addEventListener('click', () => {
    if (confirm("Usu≈Ñ zadanie?")) remove(ref(db, `tasks/${key}`));
  });
  li.appendChild(delBtn);

  // ‚úèÔ∏è edit
  const editBtn = document.createElement('span');
  editBtn.className = 'edit';
  editBtn.textContent = '‚úèÔ∏è';
  editBtn.style.cursor = 'pointer';
  editBtn.addEventListener('click', () => {
    const newText = prompt("Tre≈õƒá zadania:", t.text);
    if (newText === null) return;

    const newCategory = prompt("Kategoria (Praca/Dom/Inne):", t.category || 'Praca');
    if (newCategory === null) return;

    const newPriority = prompt("Priorytet (high/medium/low):", t.priority || 'medium');
    if (newPriority === null) return;

    const newAssigned = prompt("Przypisane do:", t.assignedTo || 'Pawe≈Ç');
    if (newAssigned === null) return;

    update(ref(db, `tasks/${key}`), {
      text: newText,
      category: newCategory,
      priority: newPriority,
      assignedTo: newAssigned
    });
  });
  li.appendChild(editBtn);
}


      
      
      
      
      
      
    taskListEl.appendChild(li);
  }

  taskCounter.textContent = totalCount===0?"Brak zada≈Ñ do wy≈õwietlenia":`Wykonane zadania: ${doneCount} / ${totalCount}`;

  // 10 kolor√≥w dla progresu
  const rainbowColors = ['#ff0000','#ff5500','#ff9900','#ffaa00','#ffff00','#aaff00','#55ff00','#00ff55','#00ffaa','#00ff00'];
  const progressPercent = totalCount===0?0:Math.round((doneCount/totalCount)*100);
  const colorIndex = Math.floor((progressPercent/100)*(rainbowColors.length-1));
  plannerTitle.style.background = rainbowColors[colorIndex];
}

onValue(tasksRef, (snapshot) => {
  tasks = snapshot.val() || {};
  renderTasks();
  resetDailyTasks(); // üî• tu dodajemy reset po wczytaniu zada≈Ñ
});


addTaskBtn.addEventListener('click',()=>{
  const text = newTaskInput.value.trim();
  if(!text) return alert('Wpisz tre≈õƒá zadania!');
  const dailyReset = dailyResetCheckbox.checked;
  const newTaskRef = ref(db, `tasks/${Date.now()}`);
  set(newTaskRef,{
    text,
    done:false,
    category:categorySelect.value,
    priority:prioritySelect.value,
    assignedTo:userSelect.value,
    dailyReset: dailyReset
  });
  newTaskInput.value='';
  dailyResetCheckbox.checked = false;
});

filterUser.addEventListener('change', renderTasks);

let holdTimeout;
plannerTitle.addEventListener('mousedown',()=>holdTimeout=setTimeout(()=>{codePrompt.style.display='block'; adminCodeInput.focus();},1000));
plannerTitle.addEventListener('mouseup',()=>clearTimeout(holdTimeout));
plannerTitle.addEventListener('touchstart',()=>holdTimeout=setTimeout(()=>{codePrompt.style.display='block'; adminCodeInput.focus();},1000));
plannerTitle.addEventListener('touchend',()=>clearTimeout(holdTimeout));

adminCodeInput.addEventListener('keydown',(e)=>{
  if(e.key==='Enter'){
    if(adminCodeInput.value==='0909'){
      isAdmin=true; adminPanel.classList.add('active'); addTaskSection.style.display='flex';
      codePrompt.style.display='none'; adminCodeInput.value='';
    }else{alert('Nieprawid≈Çowy kod PIN'); adminCodeInput.value='';}
  }
});

hideAdminBtn.addEventListener('click',()=>{isAdmin=false; adminPanel.classList.remove('active'); addTaskSection.style.display='none';});
const resetAllBtn = document.getElementById('resetAllBtn');

resetAllBtn.addEventListener('click', () => {
  if (confirm("Na pewno odznaczyƒá wszystkie zadania?")) {
    for (const key in tasks) {
      update(ref(db, `tasks/${key}`), { done: false });
    }
  }
});

loadNetworkDate();

// üîÑ reset codziennych zada≈Ñ
function resetDailyTasks() {
  const lastResetKey = 'lastResetDay';
  const today = new Date().toISOString().slice(0,10); // YYYY-MM-DD
  const lastReset = localStorage.getItem(lastResetKey);

  if (lastReset !== today) {
    for (const key in tasks) {
      if (tasks[key].dailyReset) {
        update(ref(db, `tasks/${key}`), { done: false });
      }
    }
    localStorage.setItem(lastResetKey, today);
  }
}

</script>
<div id="taskDoneOverlay">
  <div class="overlay-content">‚úîÔ∏è</div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<audio id="taskDoneSound" src="https://freesound.org/data/previews/341/341695_6245633-lq.mp3"></audio>


</body>
</html>
