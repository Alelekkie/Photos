<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<title>Planner Zada≈Ñ</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#e91e63" />
<style>
  body {
    font-family: Arial, sans-serif;
    background: #121212;
    color: #eee;
    margin: 0; padding: 20px;
  }
  .container {
    max-width: 500px;
    margin: auto;
    background: #1e1e1e;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px #e91e6390;
  }
  h1 {
    text-align: center;
    cursor: pointer;
    margin-bottom: 0;
    color: #e91e63;
    user-select: none;
    position: relative;
  }
  #dayTasksTitle {
    text-align: center;
    font-size: 1.3em;
    color: #f48fb1;
    margin: 10px 0 20px 0;
    font-weight: 600;
    user-select: none;
  }
  #codePrompt {
    display: none;
    margin-bottom: 20px;
  }
  #adminCodeInput {
    width: 100%;
    padding: 10px;
    font-size: 16px;
    border: 2px solid #444;
    border-radius: 5px;
    background: #2c2c2c;
    color: #eee;
    outline: none;
    transition: border-color 0.3s ease;
  }
  #adminCodeInput:focus {
    border-color: #777;
  }
  .admin-panel {
    display: none;
    margin-bottom: 20px;
  }
  .admin-panel.active {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
  }
  .admin-panel input,
  .admin-panel select {
    padding: 10px;
    font-size: 16px;
    border: 2px solid #444;
    border-radius: 5px;
    background: #2c2c2c;
    color: #eee;
    outline: none;
    flex: 1 1 auto;
    min-width: 100px;
  }
  .admin-panel select {
    max-width: 120px;
  }
  .admin-panel button {
    padding: 10px;
    font-size: 16px;
    background-color: #e91e63;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s ease;
    user-select: none;
    flex-shrink: 0;
  }
  .admin-panel button:hover {
    background-color: #ad1457;
  }
  #hideAdminBtn {
    background-color: #555;
    padding: 10px 15px;
  }
  ul {
    list-style: none;
    padding: 0;
  }
  li {
    background: #2c2c2c;
    padding: 10px;
    margin-bottom: 8px;
    border-radius: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #eee;
    user-select: none;
    cursor: grab;
  }
  li.done {
    background: #4a1e3d;
    color: #f8bbd0;
    text-decoration: line-through;
  }
  li.low {
    border-left: 5px solid #80cbc4;
  }
  li.medium {
    border-left: 5px solid #ffb74d;
  }
  li.high {
    border-left: 5px solid #e91e63;
  }
  .task-info {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }
  .task-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .task-text {
    font-weight: 600;
    word-break: break-word;
  }
  .task-category {
    font-size: 0.8em;
    color: #f48fb1;
    margin-left: 10px;
    font-style: italic;
  }
  .task-priority {
    font-size: 0.8em;
    color: #ccc;
  }
  .check {
    font-size: 22px;
    color: #e91e63;
    cursor: pointer;
    margin-right: 15px;
    user-select: none;
    transition: color 0.3s ease;
    flex-shrink: 0;
  }
  .check:hover {
    color: #f48fb1;
  }
  .delete {
    font-size: 22px;
    color: #f06292;
    cursor: pointer;
    user-select: none;
    transition: color 0.3s ease;
    flex-shrink: 0;
  }
  .delete:hover {
    color: #ec407a;
  }
  #taskCounter {
    text-align: center;
    margin-bottom: 15px;
    color: #f48fb1;
    font-weight: 600;
    user-select: none;
  }

  /* Responsive */
  @media screen and (max-width: 600px) {
    .container {
      width: 100%;
      padding: 15px;
    }
    .admin-panel {
      flex-direction: column;
      gap: 10px;
    }
    li {
      flex-direction: column;
      align-items: flex-start;
      cursor: default;
    }
    .check, .delete {
      font-size: 28px;
      margin-right: 10px;
      margin-top: 5px;
    }
    .task-top {
      width: 100%;
      justify-content: flex-start;
    }
    .task-category {
      margin-left: 0;
      margin-top: 4px;
    }
  }
</style>
</head>
<body>
<div class="container">
  <h1 id="plannerTitle" title="D≈Çugie przytrzymanie wy≈õwietla panel admina">Planner Zada≈Ñ</h1>
  <div id="dayTasksTitle">≈Åadujƒô datƒô...</div>
  <div id="taskCounter">0 zada≈Ñ wykonanych z 0</div>

  <div id="codePrompt">
    <input type="password" id="adminCodeInput" placeholder="Wpisz kod admina" />
  </div>

  <div class="admin-panel" id="adminPanel">
    <input type="text" id="newTaskInput" placeholder="Nowe zadanie..." />
    <select id="categorySelect" title="Kategoria">
      <option value="praca">Praca</option>
      <option value="dom">Dom</option>
      <option value="zakupy">Zakupy</option>
      <option value="inne" selected>Inne</option>
    </select>
    <select id="prioritySelect" title="Priorytet">
      <option value="low">Niski</option>
      <option value="medium" selected>≈öredni</option>
      <option value="high">Wysoki</option>
    </select>
    <button id="addTaskBtn">Dodaj</button>
    <button id="hideAdminBtn" title="Ukryj panel">‚úñ</button>
  </div>

  <ul id="taskList"></ul>
</div>

<script>
  // Formatowanie daty dd.mm.yyyy
  function formatDate(dateString) {
    const d = new Date(dateString);
    const day = String(d.getDate()).padStart(2, '0');
    const month = String(d.getMonth() + 1).padStart(2, '0');
    const year = d.getFullYear();
    return `${day}.${month}.${year}`;
  }

  // Pobierz datƒô z internetu
  async function loadNetworkDate() {
    try {
      const res = await fetch('http://worldtimeapi.org/api/ip');
      if (!res.ok) throw new Error('B≈ÇƒÖd sieci');
      const data = await res.json();
      const dateStr = formatDate(data.datetime);
      document.getElementById('dayTasksTitle').textContent = `Zadania na dzie≈Ñ: ${dateStr}`;
    } catch (e) {
      console.warn('Nie uda≈Ço siƒô pobraƒá daty z internetu, u≈ºywam lokalnej');
      const now = new Date();
      const day = String(now.getDate()).padStart(2, '0');
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const year = now.getFullYear();
      document.getElementById('dayTasksTitle').textContent = `Zadania na dzie≈Ñ: ${day}.${month}.${year}`;
    }
  }

  const taskListEl = document.getElementById('taskList');
  const newTaskInput = document.getElementById('newTaskInput');
  const addTaskBtn = document.getElementById('addTaskBtn');
  const categorySelect = document.getElementById('categorySelect');
  const prioritySelect = document.getElementById('prioritySelect');
  const adminPanel = document.getElementById('adminPanel');
  const codePrompt = document.getElementById('codePrompt');
  const adminCodeInput = document.getElementById('adminCodeInput');
  const plannerTitle = document.getElementById('plannerTitle');
  const hideAdminBtn = document.getElementById('hideAdminBtn');
  const taskCounter = document.getElementById('taskCounter');

  let tasks = [];

  // ≈Åaduj zadania z localStorage
  function loadTasks() {
    const saved = localStorage.getItem('tasks');
    tasks = saved ? JSON.parse(saved) : [];
  }

  // Zapisz zadania
  function saveTasks() {
    localStorage.setItem('tasks', JSON.stringify(tasks));
  }

  // Renderuj licznik zada≈Ñ
  function renderCounter() {
    const doneCount = tasks.filter(t => t.done).length;
    taskCounter.textContent = `${doneCount} zada≈Ñ wykonanych z ${tasks.length}`;
  }

  // Renderuj listƒô zada≈Ñ
  function renderTasks() {
    taskListEl.innerHTML = '';
    tasks.forEach((task, index) => {
      const li = document.createElement('li');
      li.className = task.done ? 'done' : '';
      li.classList.add(task.priority || 'medium');

      // Tworzymy strukturƒô
      const check = document.createElement('span');
      check.innerHTML = task.done ? '‚úÖ' : '‚¨ú';
      check.className = 'check';
      check.title = 'Odhacz/Zaznacz zadanie';
      check.addEventListener('click', () => {
        tasks[index].done = !tasks[index].done;
        saveTasks();
        renderTasks();
        renderCounter();
      });

      const taskInfo = document.createElement('div');
      taskInfo.className = 'task-info';

      const taskTop = document.createElement('div');
      taskTop.className = 'task-top';

      const taskText = document.createElement('span');
      taskText.className = 'task-text';
      taskText.textContent = task.text;

      const taskCategory = document.createElement('span');
      taskCategory.className = 'task-category';
      taskCategory.textContent = `(${task.category})`;

      taskTop.appendChild(taskText);
      taskTop.appendChild(taskCategory);
      taskInfo.appendChild(taskTop);

      // Priorytet wy≈õwietlamy poni≈ºej
      const taskPriority = document.createElement('span');
      taskPriority.className = 'task-priority';
      let prioText = '';
      if(task.priority === 'low') prioText = 'Priorytet: niski';
      else if(task.priority === 'medium') prioText = 'Priorytet: ≈õredni';
      else if(task.priority === 'high') prioText = 'Priorytet: wysoki';
      taskPriority.textContent = prioText;
      taskInfo.appendChild(taskPriority);

      const del = document.createElement('span');
      del.innerHTML = 'üóëÔ∏è';
      del.className = 'delete';
      del.title = 'Usu≈Ñ zadanie';
      del.addEventListener('click', () => {
        if(confirm('Na pewno usunƒÖƒá zadanie?')) {
          tasks.splice(index, 1);
          saveTasks();
          renderTasks();
          renderCounter();
        }
      });

      li.appendChild(check);
      li.appendChild(taskInfo);
      li.appendChild(del);

      // Do drag & drop:
      li.setAttribute('draggable', true);
      li.dataset.index = index;

      taskListEl.appendChild(li);
    });
    renderCounter();
  }

  // Dodaj zadanie
  function addTask() {
    const text = newTaskInput.value.trim();
    if (!text) return alert('Wpisz tekst zadania!');
    const category = categorySelect.value;
    const priority = prioritySelect.value;
    tasks.push({ text, category, priority, done: false });
    saveTasks();
    renderTasks();
    newTaskInput.value = '';
    newTaskInput.focus();
  }

  addTaskBtn.addEventListener('click', addTask);
  newTaskInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') addTask();
  });

  // Panel admina - pokazuje siƒô po d≈Çugim przytrzymaniu tytu≈Çu
  let pressTimer;
  plannerTitle.addEventListener('mousedown', () => {
    pressTimer = setTimeout(() => {
      codePrompt.style.display = 'block';
      adminCodeInput.focus();
    }, 1000);
  });
  plannerTitle.addEventListener('mouseup', () => {
    clearTimeout(pressTimer);
  });
  plannerTitle.addEventListener('mouseleave', () => {
    clearTimeout(pressTimer);
  });

  adminCodeInput.addEventListener('keydown', e => {
    if(e.key === 'Enter') {
      checkAdminCode();
    }
  });

  function checkAdminCode() {
    const code = adminCodeInput.value.trim();
    if(code === '0909') {
      adminPanel.classList.add('active');
      codePrompt.style.display = 'none';
      adminCodeInput.value = '';
    } else {
      alert('Nieprawid≈Çowy kod');
    }
  }

  hideAdminBtn.addEventListener('click', () => {
    adminPanel.classList.remove('active');
  });

  // Drag & Drop obs≈Çuga
  let dragSrcEl = null;

  function handleDragStart(e) {
    dragSrcEl = e.currentTarget;
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/html', dragSrcEl.outerHTML);
    dragSrcEl.classList.add('dragElem');
  }

  function handleDragOver(e) {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
    return false;
  }

  function handleDrop(e) {
    e.stopPropagation();

    if (dragSrcEl !== this) {
      const fromIndex = parseInt(dragSrcEl.dataset.index);
      const toIndex = parseInt(this.dataset.index);

      // Zamiana zada≈Ñ miejscami w tablicy
      const temp = tasks[fromIndex];
      tasks.splice(fromIndex, 1);
      tasks.splice(toIndex, 0, temp);

      saveTasks();
      renderTasks();
    }
    return false;
  }

  function handleDragEnd(e) {
    e.currentTarget.classList.remove('dragElem');
  }

  function addDnDHandlers() {
    const items = taskListEl.querySelectorAll('li');
    items.forEach(item => {
      item.addEventListener('dragstart', handleDragStart, false);
      item.addEventListener('dragover', handleDragOver, false);
      item.addEventListener('drop', handleDrop, false);
      item.addEventListener('dragend', handleDragEnd, false);
    });
  }

  // Render tasks + bind drag & drop po wyrenderowaniu
  function renderTasksAndDnD() {
    renderTasks();
    addDnDHandlers();
  }

  loadNetworkDate();
  loadTasks();
  renderTasksAndDnD();
</script>
</body>
</html>
